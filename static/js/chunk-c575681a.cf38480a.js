(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c575681a"],{3123:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var n=a("b775");function i(){return Object(n["a"])({url:Object({VUE_APP_BASE_API:"/prod-api",NODE_ENV:"production",BASE_URL:"/dash-ui/"}).VUE_APP_XIAOCHENGXU_API+"/api/v1/upload/token",method:"get"})}},"4e82":function(t,e,a){"use strict";var n=a("23e7"),i=a("1c0b"),s=a("7b0b"),r=a("d039"),l=a("a640"),o=[],c=o.sort,u=r((function(){o.sort(void 0)})),d=r((function(){o.sort(null)})),f=l("sort"),m=u||!d||!f;n({target:"Array",proto:!0,forced:m},{sort:function(t){return void 0===t?c.call(s(this)):c.call(s(this),i(t))}})},5302:function(t,e,a){"use strict";a.d(e,"c",(function(){return i})),a.d(e,"e",(function(){return s})),a.d(e,"b",(function(){return r})),a.d(e,"d",(function(){return l})),a.d(e,"a",(function(){return o}));a("e9c4"),a("b64b");var n=a("b775");function i(t,e){return Object(n["a"])({url:"/system/management/music/getMusic",method:"post",params:t,data:e,headers:{"Content-Type":"application/json"},transformRequest:[function(t,e){for(var a in t)""===t[a]&&delete t[a];return t=JSON.stringify(t),t}]})}function s(t){return Object(n["a"])({url:"/system/management/music/saveOrUpdate",method:"post",data:t,transformRequest:[function(t){console.log(t);var e=Object.keys(t).length,a=0,n="";for(var i in t)n+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]),a<e-1&&(n+="&",a++);return n}],headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function r(t){return Object(n["a"])({url:"/system/management/music/deleteMusic",method:"get",params:t})}function l(t,e){return Object(n["a"])({url:"/system/management/getSystemLogs",method:"post",params:t,data:e,headers:{"Content-Type":"application/json"},transformRequest:[function(t,e){for(var a in t)""===t[a]&&delete t[a];return t=JSON.stringify(t),t}]})}function o(t){return Object(n["a"])({url:"/system/config/activity/save",method:"post",params:t})}},7352:function(t,e,a){},adfc:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main-content"},[a("div",{staticClass:"left-container"},[a("el-menu",{staticStyle:{"margin-bottom":"20px"},attrs:{"default-active":"1",mode:"horizontal",router:""}},[a("el-menu-item",{attrs:{index:"1",route:{path:"/platform/music/"}}},[t._v("音乐列表")])],1),a("el-row",{staticClass:"filter-container",staticStyle:{"margin-bottom":"20px"},attrs:{type:"flex"}},[a("el-button",{staticStyle:{"min-width":"120px"},attrs:{type:"primary",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:t.goCreate}},[t._v("添加音乐")])],1),a("el-row",{staticClass:"list"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":"",size:"small","header-cell-style":{"background-color":"#f7f9fa",color:"#637282;"}},on:{"sort-change":t.sortChange}},[a("el-table-column",{attrs:{prop:"id",label:"ID",sortable:"",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.id))])]}}])}),a("el-table-column",{attrs:{label:"音乐"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.name))])]}}])}),a("el-table-column",{attrs:{label:"url",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("a",{staticStyle:{color:"#409EFF"},attrs:{target:"_blank",href:n.url}},[t._v(t._s(n.url))])]}}])}),a("el-table-column",{attrs:{label:"分类",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.firstClass+"-"+n.secondClass))])]}}])}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.createdAt))])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.handleDetele(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.current,limit:t.listQuery.size},on:{"update:page":function(e){return t.$set(t.listQuery,"current",e)},"update:limit":function(e){return t.$set(t.listQuery,"size",e)},pagination:t.getList}}),a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,"modal-append-to-body":!1,"append-to-body":!0},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"70px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.temp.name,callback:function(e){t.$set(t.temp,"name",e)},expression:"temp.name"}})],1),a("el-form-item",{attrs:{label:"分类",placeholder:"请选择一级和二级分类",prop:"firstClass"}},[a("el-cascader",{attrs:{options:t.optionsClass,placeholder:"请选择"},on:{change:t.handleClassChange},model:{value:t.valueClass,callback:function(e){t.valueClass=e},expression:"valueClass"}})],1),a("el-form-item",{attrs:{label:"url",prop:"url"}},[a("el-input",{model:{value:t.temp.url,callback:function(e){t.$set(t.temp,"url",e)},expression:"temp.url"}}),a("el-upload",{staticClass:"avatar-uploader",attrs:{data:t.dataObj,multiple:!1,action:"http://upload-z2.qiniup.com","show-file-list":!1,"on-success":t.handleSuccess,"before-upload":t.beforeUpload}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传MP3文件")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData()}}},[t._v(" 确认 ")])],1)],1)],1)],1)])},i=[],s=(a("4e82"),a("c740"),a("a434"),a("d3b7"),a("4328"),a("bc3a"),a("5302")),r=a("3123"),l=a("333d"),o={components:{Pagination:l["a"]},data:function(){return{list:[],total:0,listLoading:!0,listQuery:{searchStr:"",current:1,size:20},clientHeight:"",maxHeight:400,temp:{id:"",merchantId:0,name:"",firstClass:"",secondClass:"",url:""},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑",create:"创建"},rules:{url:[{required:!0,message:"type is required",trigger:"change"}],firstClass:[{required:!0,message:"firstClass is required",trigger:"change"}],name:[{required:!0,message:"音乐名称不能为空",trigger:"blur"}]},valueClass:[],optionsClass:[{value:"通用",label:"通用",children:[{value:"大气",label:"大气"},{value:"轻快",label:"轻快"}]},{value:"儿童",label:"儿童",children:[{value:"儿童",label:"儿童"}]},{value:"节日",label:"节日",children:[{value:"节日",label:"节日"}]},{value:"商务",label:"商务",children:[{value:"商务",label:"商务"}]}],dataObj:{token:""}}},watch:{clientHeight:function(){this.changeFixed(this.clientHeight)}},created:function(){this.getList(),this.fetchToken()},mounted:function(){this.clientHeight="".concat(document.documentElement.clientHeight);var t=this;window.onresize=function(){t.clientHeight="".concat(document.documentElement.clientHeight)}},methods:{changeFixed:function(t){this.maxHeight=t-85-110-100},getList:function(){var t=this;this.listLoading=!0,Object(s["c"])(this.listQuery).then((function(e){t.list=e.data.records,t.total=e.data.total,t.listLoading=!1}))},handleFilter:function(){this.listQuery.current=1,this.getList()},sortChange:function(t){var e=t.prop,a=t.order;"id"===e&&this.sortByID(a)},sortByID:function(t){this.listQuery.sort="ascending"===t?"+id":"-id",this.handleFilter()},resetTemp:function(){this.temp={id:"",merchantId:0,name:"",firstClass:"",secondClass:"",url:""}},goCreate:function(){var t=this;this.resetTemp(),this.valueClass=[],this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs["dataForm"].clearValidate()}))},createData:function(){var t=this,e=this;this.$refs["dataForm"].validate((function(a){if(a){var n=Object.assign({},t.temp);Object(s["e"])(n).then((function(){t.dialogFormVisible=!1,t.$message({message:"成功",type:"success",duration:2e3,onClose:function(){e.listQuery.current=1,e.getList()}})}))}}))},handleEdit:function(t,e){var a=this;this.temp=Object.assign({},e),this.valueClass=[],this.valueClass.push(this.temp.firstClass),this.valueClass.push(this.temp.secondClass),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){a.$refs["dataForm"].clearValidate()}))},updateData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var a=Object.assign({},t.temp);Object(s["e"])(a).then((function(){var e=t.list.findIndex((function(e){return e.id===t.temp.id}));t.list.splice(e,1,t.temp),t.dialogFormVisible=!1,t.$message({message:"修改成功",type:"success",duration:2e3})}))}}))},handleDetele:function(t,e){var a=this;this.$confirm("确认删除音乐?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["b"])({musicId:e.id}).then((function(e){1*e.code===200?(a.$message({type:"success",message:"操作成功!"}),a.list.splice(t,1)):a.$message({type:"error",message:e.msg})}))})).catch((function(){a.$message({type:"info",message:"已取消操作"})}))},handleClassChange:function(t){this.temp.firstClass=t[0],this.temp.secondClass=t[1]},fetchToken:function(){var t=this;return new Promise((function(e,a){Object(r["a"])().then((function(a){var n=a.data;t._data.dataObj.token=n,e(!0)})).catch((function(t){console.log(t),a(!1)}))}))},beforeUpload:function(t){},handleSuccess:function(t,e){this.temp.url="https://ttz-user-file.qiniu.tuantuanzhan.cn/"+t.key}}},c=o,u=(a("d1b4"),a("2877")),d=Object(u["a"])(c,n,i,!1,null,"d58fffe2",null);e["default"]=d.exports},c740:function(t,e,a){"use strict";var n=a("23e7"),i=a("b727").findIndex,s=a("44d2"),r=a("ae40"),l="findIndex",o=!0,c=r(l);l in[]&&Array(1)[l]((function(){o=!1})),n({target:"Array",proto:!0,forced:o||!c},{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),s(l)},d1b4:function(t,e,a){"use strict";a("7352")}}]);